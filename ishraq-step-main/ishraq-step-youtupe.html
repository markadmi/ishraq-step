<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ishraq Step - Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø±Ø¦ÙŠØ©</title>
  <link rel="stylesheet" href="css/video.css">
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="css/open-sidebar.css">

  <style>
    body.loaded #globalLoader {
      opacity: 0;
      pointer-events: none;
    }

    #globalLoader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #ffffffee;
      backdrop-filter: blur(3px);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 15px;
      font-size: 22px;
      color: #4caf50;
      font-weight: bold;
      transition: opacity 0.4s ease;
      z-index: 9999;
    }

    .circle-loader {
      width: 55px;
      height: 55px;
      border: 6px solid #cfcfcf;
      border-top-color: #4caf50;
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); }}

    .sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 15px;
    }

    #videos-container { display: none; padding: 15px; }

    .loader-inline {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      margin-bottom: 15px;
      background: #fff;
      border-radius: 10px;
      font-weight: bold;
      color: #4caf50;
    }

    .loader-inline .spinner {
      width: 16px;
      height: 16px;
      border: 3px solid #ddd;
      border-top-color: #4caf50;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .section-card {
      background: linear-gradient(135deg, #4caf50, #00eeff);
      color: white;
      border-radius: 14px;
      text-align: center;
      padding: 18px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.25s;
      box-shadow: 0 4px 10px #4caf5088;
    }

    .section-card:hover {
      transform: translateY(-5px) scale(1.03);
      box-shadow: 0 8px 20px #4caf50aa;
    }

    .video iframe {
      width: 100%;
      max-width: 600px;
      height: 315px;
      border: none;
      border-radius: 10px;
    }
  </style>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4496926993663116" crossorigin="anonymous"></script>
</head>

<body>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="globalLoader">
    <div class="circle-loader"></div>
    Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
  </div>

  <header>ğŸ“š Ishraq Step - Ø§Ù„Ø¯Ø±ÙˆØ³</header>

  <input type="checkbox" id="toggleSidebar">
  <label for="toggleSidebar" class="toggle-btn">â˜°</label>

  <iframe id="siteSidebar" src="sidebar.html"></iframe>

  <!-- Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div id="sections-container" class="sections">
    <div class="section-card" data-type="Ù…Ø§Ø« 0">ğŸ§® Ù…Ø§Ø« 0</div>
    <div class="section-card" data-type="Ù…Ø§Ø« 1">ğŸ§® Ù…Ø§Ø« 1</div>
    <div class="section-card" data-type="Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ">ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</div>
    <div class="section-card" data-type="Ø¯ÙˆØ§Ø¦Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©">ğŸ”Œ Ø¯ÙˆØ§Ø¦Ø± ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</div>
    <div class="section-card" data-type="Ø§Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ù‡">âš–ï¸ Ø£Ø®Ù„Ø§Ù‚ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ù†Ø©</div>
    <div class="section-card" data-type="Ù…Ù‚Ø¯Ù…Ø© Ø­Ø§Ø³Ø¨ Ø§Ù„ÙŠ">ğŸ’» Ù…Ù‚Ø¯Ù…Ø© Ø­Ø§Ø³Ø¨ Ø¢Ù„ÙŠ</div>
    <div class="section-card" data-type="ÙÙŠØ²ÙŠØ§Ø¡">ğŸ§² ÙÙŠØ²ÙŠØ§Ø¡</div>
    <div class="section-card" data-type="ÙƒÙˆØ±Ø³Ø§Øª Ø§Ø®Ø±Ù‰">ğŸ§  ÙƒÙˆØ±Ø³Ø§Øª Ø£Ø®Ø±Ù‰</div>
  </div>

  <!-- ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù‚Ø³Ù… -->
  <div id="videos-container">
    <button class="back-btn">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
    <h2 id="section-title"></h2>

    <div id="loader-inline" class="loader-inline">
      <div class="spinner"></div>
      ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...
    </div>

    <div id="subsections-list" style="display:none; padding:12px; gap:10px;"></div>
    <div id="videos-list"></div>
  </div>

  <footer>Â© 2025 Ishraq Step â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</footer>

  <!-- Firebase -->
  <script type="module">
    import { db } from './chat/js/fb.js';
    import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const globalLoader = document.getElementById('globalLoader');
    const loaderInline = document.getElementById('loader-inline');

    let coursesData = {};

    onValue(ref(db, 'courses'), snapshot => {
      coursesData = snapshot.val() || {};
      setTimeout(() => document.body.classList.add('loaded'), 300);
    });


    function showInlineLoader(show){ loaderInline.style.display = show ? 'flex' : 'none'; }

    const sectionsContainer = document.getElementById('sections-container');
    const videosContainer = document.getElementById('videos-container');
    const videosList = document.getElementById('videos-list');
    const sectionTitle = document.getElementById('section-title');
    const subsectionsList = document.getElementById('subsections-list');


    document.querySelectorAll('.section-card').forEach(card => {
      card.addEventListener('click', () => {
        const type = card.dataset.type;
        showSectionVideos(type);
      });
    });


    function showSectionVideos(type) {
      sectionsContainer.style.display = 'none';
      videosContainer.style.display = 'block';
      sectionTitle.textContent = `ğŸ“ ${type}`;
      videosList.innerHTML = '';
      subsectionsList.innerHTML = '';
      subsectionsList.style.display = 'none';

      showInlineLoader(true);

      requestAnimationFrame(() => {
        const all = Object.values(coursesData || {});
        const filtered = all.filter(item => item.type === type);

        if (filtered.length === 0) {
          videosList.innerHTML = '<p>ğŸš§ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø¨Ø¹Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>';
          showInlineLoader(false);
          return;
        }

        const subs = Array.from(new Set(filtered.map(v => (v.subsection||'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ').trim())));

        if(subs.length > 1 || (subs.length===1 && subs[0] !== '')) {
          subsectionsList.style.display = 'flex';
          subsectionsList.style.flexWrap = 'wrap';
          subsectionsList.style.gap = '10px';

          const allBtn = document.createElement('div');
          allBtn.className = 'section-card';
          allBtn.textContent = 'ğŸŸ¢ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„';
          allBtn.addEventListener('click', ()=> renderVideos(filtered));
          subsectionsList.appendChild(allBtn);

          subs.forEach(s => {
            const label = s || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ';
            const card = document.createElement('div');
            card.className = 'section-card';
            card.textContent = label;
            card.addEventListener('click', ()=> {
              const items = filtered.filter(v => ((v.subsection||'').trim() || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù… ÙØ±Ø¹ÙŠ') === label);
              renderVideos(items);
            });
            subsectionsList.appendChild(card);
          });

          renderVideos(filtered);
          showInlineLoader(false);
          return;
        }

        renderVideos(filtered);
        showInlineLoader(false);
      });
    }


    function renderVideos(list){
      videosList.innerHTML = '';
      list.forEach(video => {
        const div = document.createElement('div');
        div.className = 'video';
        const subLabel = (video.subsection || '').trim();
        div.innerHTML = `
          <iframe src="${video.url}" allowfullscreen></iframe>
          <h2>${video.title}</h2>
          ${ subLabel ? `<h3 style="color:#4caf50;">${subLabel}</h3>` : '' }
          <p>${video.description}</p>
        `;
        videosList.appendChild(div);
      });
    }


    document.querySelector('.back-btn').addEventListener('click', () => {
      videosContainer.style.display = 'none';
      sectionsContainer.style.display = 'grid';
      sectionTitle.textContent = ''; 
      videosList.innerHTML = '';
      showInlineLoader(false);
    });

  </script>

</body>
</html>
