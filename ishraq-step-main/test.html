<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ“ Ø­Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - Ishraq Step</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{--accent:#4caf50; --danger:#f44336; --warning:#ff9800}
  *{box-sizing:border-box}
  body{font-family:'Cairo',sans-serif;margin:0;background:linear-gradient(135deg,#0b0b0d 0%,#071018 100%);color:#e8eef6;padding:0;direction:rtl}
  .exam-container{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 280px;gap:20px;padding:20px}
  
  .exam-main{background:#0f1113;border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:24px}
  .exam-sidebar{background:#0f1113;border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:16px;height:fit-content;position:sticky;top:20px}
  
  .header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid rgba(255,255,255,0.1)}
  .header h1{margin:0;color:var(--accent);font-size:22px}
  .timer{font-size:18px;font-weight:700;padding:8px 16px;background:rgba(244,67,54,0.1);border-radius:8px;color:var(--danger)}
  .timer.warning{background:rgba(255,152,0,0.1);color:var(--warning)}
  
  .question-container{margin-bottom:32px;padding:20px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:12px}
  .question-number{color:var(--accent);font-weight:700;font-size:14px;margin-bottom:8px}
  .question-text{font-size:18px;font-weight:600;margin:12px 0;color:#e8eef6}
  
  .choices{display:flex;flex-direction:column;gap:12px;margin-top:16px}
  .choice-btn{background:rgba(255,255,255,0.03);border:2px solid rgba(255,255,255,0.1);color:#e8eef6;padding:12px 16px;border-radius:10px;cursor:pointer;text-align:right;font-weight:500;transition:all .3s}
  .choice-btn:hover{background:rgba(76,175,80,0.1);border-color:var(--accent)}
  .choice-btn.selected{background:var(--accent);color:#08121a;border-color:var(--accent)}
  .choice-btn.correct{background:rgba(76,175,80,0.2);border-color:var(--accent)}
  .choice-btn.incorrect{background:rgba(244,67,54,0.2);border-color:var(--danger)}
  
  .nav-buttons{display:flex;gap:8px;margin-top:24px;justify-content:center}
  .btn{padding:10px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600;transition:all .3s}
  .btn-primary{background:var(--accent);color:#08121a}
  .btn-primary:hover{opacity:.9;transform:translateY(-2px)}
  .btn-danger{background:var(--danger);color:#fff}
  .btn-neutral{background:rgba(255,255,255,0.1);color:#e8eef6}
  .btn-neutral:hover{background:rgba(255,255,255,0.15)}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  
  .sidebar-section{margin-bottom:16px}
  .sidebar-label{font-size:12px;font-weight:700;color:var(--accent);margin-bottom:8px;text-transform:uppercase}
  .questions-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;max-height:300px;overflow-y:auto}
  .q-indicator{width:100%;aspect-ratio:1;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:6px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;font-weight:700;transition:all .2s}
  .q-indicator:hover{background:rgba(76,175,80,0.2)}
  .q-indicator.active{background:var(--accent);color:#08121a;border-color:var(--accent)}
  .q-indicator.answered{background:rgba(76,175,80,0.3);border-color:var(--accent)}
  
  .stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:16px;font-size:12px}
  .stat-item{background:rgba(255,255,255,0.05);padding:8px;border-radius:6px;text-align:center}
  .stat-label{color:#9aa3af;font-size:11px}
  .stat-value{color:var(--accent);font-weight:700;font-size:14px}
  
  /* Result Screen */
  .result-container{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:40px;text-align:center;margin:20px}
  .result-score{font-size:48px;font-weight:800;color:var(--accent);margin:20px 0}
  .result-message{font-size:20px;margin:20px 0;color:#e8eef6}
  .result-details{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:30px 0}
  .result-stat{background:rgba(255,255,255,0.05);padding:16px;border-radius:10px}
  .result-stat-label{color:#9aa3af;font-size:14px;margin-bottom:8px}
  .result-stat-value{font-size:24px;font-weight:700;color:var(--accent)}
  
  .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:9999;align-items:center;justify-content:center}
  .modal.show{display:flex}
  .modal-content{background:#0f1113;border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:24px;max-width:600px;max-height:80vh;overflow-y:auto;color:#e8eef6}
  .modal-close{float:left;background:none;border:none;color:#e8eef6;font-size:24px;cursor:pointer}
  
  .review-item{background:rgba(255,255,255,0.05);padding:16px;border-radius:10px;margin-bottom:12px;border-right:4px solid rgba(255,255,255,0.1)}
  .review-item.wrong{border-right-color:var(--danger)}
  .review-q{font-weight:700;color:#e8eef6;margin-bottom:8px}
  .review-answer{font-size:14px;color:#9aa3af;margin:6px 0}
  .review-correct{color:var(--accent)}
  .review-incorrect{color:var(--danger)}
  
  @media(max-width:968px){
    .exam-container{grid-template-columns:1fr;gap:16px}
    .exam-sidebar{position:static}
    .questions-grid{grid-template-columns:repeat(6,1fr)}
  }
  @media(min-width:900px){ body{margin-inline-end:320px !important} }
  #siteSidebar{position:fixed;top:0;right:0;height:100vh;width:300px;border:0;z-index:9999}
</style>
</head>
<body>
  <div class="exam-container" id="examContainer">
    <!-- Main Exam Area -->
    <div class="exam-main">
      <div class="header">
        <h1 id="examTitle">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...</h1>
        <div class="timer" id="timer">00:00</div>
      </div>

      <div id="questionArea"></div>

      <div class="nav-buttons">
        <button class="btn btn-neutral" id="prevBtn" disabled>â¬…ï¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn btn-neutral" id="nextBtn">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
      </div>

      <div style="margin-top:20px;display:flex;gap:8px;justify-content:center">
        <button class="btn btn-danger" id="submitBtn">ğŸ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
      </div>

      <!-- Result Screen (Hidden) -->
      <div id="resultScreen" style="display:none;width:100%">
        <div class="result-container">
          <h2 style="color:var(--accent);margin-top:0">âœ… ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
          <div style="font-size:60px;margin:20px 0">ğŸ“Š</div>
          
          <div class="result-score" id="scoreDisplay">0/0</div>
          <div class="result-message" id="resultMessage"></div>
          
          <div class="result-details">
            <div class="result-stat">
              <div class="result-stat-label">âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
              <div class="result-stat-value" id="correctCount">0</div>
            </div>
            <div class="result-stat">
              <div class="result-stat-label">âŒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</div>
              <div class="result-stat-value" id="wrongCount">0</div>
            </div>
            <div class="result-stat">
              <div class="result-stat-label">ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</div>
              <div class="result-stat-value" id="percentage">0%</div>
            </div>
          </div>

          <div style="margin-top:40px;padding:20px;background:rgba(76,175,80,0.1);border-radius:12px;border:2px solid var(--accent)">
            <div style="text-align:center;font-size:20px;color:var(--accent);font-weight:700">
              ğŸ† Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalScore" style="font-size:32px">0/0</span>
            </div>
          </div>

          <div style="margin-top:24px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
            <button class="btn btn-primary" id="reviewBtn">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡</button>
            <button class="btn btn-neutral" onclick="location.href='tests.html'">ğŸ  Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="exam-sidebar">
      <div class="sidebar-section">
        <div class="sidebar-label">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</div>
        <div class="questions-grid" id="questionsGrid"></div>
      </div>
      
      <div class="sidebar-section stats">
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</div>
          <div class="stat-value" id="answeredCount">0/0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
          <div class="stat-value" id="remainingCount">0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Review Modal -->
  <div class="modal" id="reviewModal">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('reviewModal').classList.remove('show')">&times;</button>
      <h2 style="margin-top:0;color:var(--accent)">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø©</h2>
      <div id="reviewList"></div>
    </div>
  </div>

  <script type="module">
    import { db } from './chat/js/fb.js';
    import { ref, get, child } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const examContainer = document.getElementById('examContainer');
    const examTitle = document.getElementById('examTitle');
    const timer = document.getElementById('timer');
    const questionArea = document.getElementById('questionArea');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const questionsGrid = document.getElementById('questionsGrid');
    const resultScreen = document.getElementById('resultScreen');
    const reviewModal = document.getElementById('reviewModal');
    const reviewList = document.getElementById('reviewList');

    let testData = null;
    let questions = [];
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let timeLeft = 0;
    let timerInterval = null;
    let isSubmitted = false;

    const testId = new URLSearchParams(location.search).get('id');
    
    // âœ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ sessionStorage Ù„Ù…Ù†Ø¹ ÙÙ‚Ø¯Ø§Ù†Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    function saveSessionData(){
      const data = {
        testId,
        testData,
        questions,
        currentQuestionIndex,
        userAnswers,
        timeLeft,
        isSubmitted
      };
      sessionStorage.setItem('examSession', JSON.stringify(data));
    }

    function loadSessionData(){
      const saved = sessionStorage.getItem('examSession');
      if(saved){
        try{
          const data = JSON.parse(saved);
          if(data.testId === testId && !data.isSubmitted){
            testData = data.testData;
            questions = data.questions;
            currentQuestionIndex = data.currentQuestionIndex;
            userAnswers = data.userAnswers;
            timeLeft = data.timeLeft;
            isSubmitted = data.isSubmitted;
            return true;
          }
        }catch(e){}
      }
      return false;
    }

    // âœ… Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
    window.addEventListener('beforeunload', (e)=>{
      if(!isSubmitted && questions.length > 0){
        e.preventDefault();
        e.returnValue = '';
        return '';
      }
    });

    if (!testId) {
      examContainer.innerHTML = '<div style="color:var(--danger);padding:20px">Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
    } else {
      // Ø­Ø§ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹
      if(loadSessionData()){
        // Ø§Ø³ØªØ±Ø¬Ø¹ Ù…Ù† sessionStorage
        examTitle.textContent = testData.title || 'Ø§Ø®ØªØ¨Ø§Ø±';
        startTimer();
        renderQuestion();
        renderQuestionsGrid();
        updateStats();
      } else {
        // Ø­Ù…Ù„ Ù…Ù† Firebase
        loadTest();
      }
    }

    async function loadTest(){
      try{
        const snap = await get(child(ref(db), `tests/${testId}`));
        if(!snap.exists()){
          examContainer.innerHTML = '<div style="color:var(--danger);padding:20px">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
          return;
        }
        testData = snap.val();
        examTitle.textContent = testData.title || 'Ø§Ø®ØªØ¨Ø§Ø±';
        
        questions = (testData.questions || []).map(q => ({
          id: q.id,
          text: q.text || '',
          imageUrl: q.imageUrl || '',
          choices: (q.choices || []).map(c => ({
            text: c.text || '',
            correct: !!c.isCorrect
          }))
        }));
        
        if(questions.length === 0){
          examContainer.innerHTML = '<div style="color:var(--danger);padding:20px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
          return;
        }
        
        timeLeft = (testData.duration || 60) * 60;
        startTimer();
        renderQuestion();
        renderQuestionsGrid();
        updateStats();
        saveSessionData();
      }catch(err){
        console.error(err);
        examContainer.innerHTML = '<div style="color:var(--danger);padding:20px">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
      }
    }

    function startTimer(){
      timer.textContent = formatTime(timeLeft);
      timerInterval = setInterval(()=>{
        timeLeft--;
        timer.textContent = formatTime(timeLeft);
        saveSessionData(); // âœ… Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        
        if(timeLeft <= 300) timer.classList.add('warning');
        if(timeLeft <= 0){
          clearInterval(timerInterval);
          submitTest();
        }
      }, 1000);
    }

    function formatTime(seconds){
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }

    function renderQuestion(){
      if(currentQuestionIndex < 0 || currentQuestionIndex >= questions.length) return;
      
      const q = questions[currentQuestionIndex];
      const saved = userAnswers[currentQuestionIndex];
      
      questionArea.innerHTML = `
        <div class="question-container">
          <div class="question-number">Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestionIndex+1} Ù…Ù† ${questions.length}</div>
          <div class="question-text">${escapeHtml(q.text)}</div>
          ${q.imageUrl ? `<img src="${escapeAttr(q.imageUrl)}" style="max-width:100%;border-radius:8px;margin:12px 0">` : ''}
          <div class="choices">
            ${q.choices.map((c, i)=>{
              let classes = 'choice-btn';
              if(saved === i) classes += ' selected';
              if(isSubmitted){
                if(c.correct) classes = 'choice-btn correct';
                else if(saved === i) classes = 'choice-btn incorrect';
              }
              return `<button class="${classes}" onclick="selectAnswer(${i})" ${isSubmitted?'disabled':''}>
                ${String.fromCharCode(65+i)}: ${escapeHtml(c.text)}
              </button>`;
            }).join('')}
          </div>
        </div>
      `;
      
      prevBtn.disabled = currentQuestionIndex === 0;
      nextBtn.disabled = currentQuestionIndex === questions.length - 1;
      updateStats();
      questionsGrid.querySelectorAll('.q-indicator').forEach((el,i)=>{
        el.classList.toggle('active', i === currentQuestionIndex);
      });
    }

    window.selectAnswer = function(choiceIndex){
      if(isSubmitted) return;
      userAnswers[currentQuestionIndex] = choiceIndex;
      saveSessionData(); // âœ… Ø§Ø­ÙØ¸ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ÙÙˆØ±Ø§Ù‹
      renderQuestion();
      questionsGrid.querySelector(`[data-q="${currentQuestionIndex}"]`).classList.add('answered');
      updateStats();
    };

    function renderQuestionsGrid(){
      questionsGrid.innerHTML = questions.map((q, i)=>`
        <div class="q-indicator ${i === currentQuestionIndex ? 'active' : ''} ${userAnswers[i] !== undefined ? 'answered' : ''}" 
          data-q="${i}" 
          onclick="goToQuestion(${i})">
          ${i+1}
        </div>
      `).join('');
    }

    window.goToQuestion = function(index){
      currentQuestionIndex = index;
      renderQuestion();
    };

    prevBtn.addEventListener('click', ()=>{
      if(currentQuestionIndex > 0){
        currentQuestionIndex--;
        renderQuestion();
      }
    });

    nextBtn.addEventListener('click', ()=>{
      if(currentQuestionIndex < questions.length - 1){
        currentQuestionIndex++;
        renderQuestion();
      }
    });

    submitBtn.addEventListener('click', ()=>{
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ….')){
        submitTest();
      }
    });

    function submitTest(){
      clearInterval(timerInterval);
      isSubmitted = true;
      saveSessionData(); // âœ… Ø§Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ù„ÙŠÙ…
      
      let correct = 0;
      let wrong = 0;
      const wrongAnswers = [];
      
      questions.forEach((q, i)=>{
        const userChoice = userAnswers[i];
        if(userChoice === undefined){
          wrong++;
          wrongAnswers.push({
            question: q, 
            userChoice: undefined, 
            correctChoice: q.choices.findIndex(c=>c.correct),
            unanswered: true
          });
        } else if(q.choices[userChoice].correct){
          correct++;
        } else {
          wrong++;
          wrongAnswers.push({
            question: q, 
            userChoice, 
            correctChoice: q.choices.findIndex(c=>c.correct)
          });
        }
      });
      
      const percentage = Math.round((correct / questions.length) * 100);
      const score = correct;
      const maxScore = questions.length;
      
      document.getElementById('scoreDisplay').textContent = `${score}/${maxScore}`;
      document.getElementById('finalScore').textContent = `${score}/${maxScore}`;
      document.getElementById('correctCount').textContent = correct;
      document.getElementById('wrongCount').textContent = wrong;
      document.getElementById('percentage').textContent = `${percentage}%`;
      
      let message = '';
      if(percentage >= 90) message = 'ğŸ‰ğŸ‰ Ù…Ù…ØªØ§Ø² Ø¬Ø¯Ø§Ù‹! Ø£Ø¯Ø§Ø¡ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ';
      else if(percentage >= 80) message = 'ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²';
      else if(percentage >= 70) message = 'ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
      else if(percentage >= 60) message = 'ğŸ‘ Ø¬ÙŠØ¯ØŒ ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡';
      else if(percentage >= 50) message = 'ğŸ“š Ù…ØªÙˆØ³Ø·ØŒ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†';
      else if(percentage >= 40) message = 'ğŸ“š Ø¶Ø¹ÙŠÙØŒ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† ÙƒØ¨ÙŠØ±';
      else message = 'âŒ ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©';
      
      document.getElementById('resultMessage').textContent = message;
      
      document.getElementById('reviewBtn').onclick = ()=>{
        showReview(wrongAnswers);
      };
      
      document.querySelector('.exam-main').style.display = 'none';
      document.querySelector('.exam-sidebar').style.display = 'none';
      resultScreen.style.display = 'block';
      
      // âœ… Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…
      setTimeout(()=>{
        sessionStorage.removeItem('examSession');
      }, 2000);
    }

    function showReview(wrongAnswers){
      reviewList.innerHTML = wrongAnswers.map(item=>`
        <div class="review-item wrong">
          <div class="review-q">${escapeHtml(item.question.text)}</div>
          <div class="review-answer">
            ${item.unanswered ? 
              '<span class="review-incorrect">âŒ Ù„Ù… ØªÙØ¬Ø¨ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„</span>' :
              `Ø¥Ø¬Ø§Ø¨ØªÙƒ: <span class="review-incorrect">${escapeHtml(item.question.choices[item.userChoice].text)}</span>`
            }
          </div>
          <div class="review-answer">
            Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <span class="review-correct">${escapeHtml(item.question.choices[item.correctChoice].text)}</span>
          </div>
        </div>
      `).join('') || '<div style="color:var(--accent);padding:16px;text-align:center">ğŸ‰ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø®Ø§Ø·Ø¦Ø©! Ø£Ø¯Ø§Ø¡ Ù…Ø«Ø§Ù„ÙŠ!</div>';
      reviewModal.classList.add('show');
    }

    function updateStats(){
      const answered = Object.keys(userAnswers).length;
      document.getElementById('answeredCount').textContent = `${answered}/${questions.length}`;
      document.getElementById('remainingCount').textContent = questions.length - answered;
    }

    function escapeHtml(s){
      return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    function escapeAttr(s){
      return (s||'').replaceAll('"','%22');
    }
  </script>

  <iframe src="sidebar.html" id="siteSidebar" title="Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø§Ù†Ø¨ÙŠØ© â€” Ishraq Step"></iframe>
</body>
</html>